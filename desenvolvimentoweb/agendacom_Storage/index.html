<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Agenda </title>
    <link rel="stylesheet" href="./index.css"> 
</head>
<body>
    <main> 
        <form> 
            <input type="hidden" name="id"/> 
            <input  name="nome" type="text" maxlength="50" placeholder="Nome" required />
            <input name="telefone" type="text" maxlength="50" placeholder="Telefone" required />
            <input name="email" type="text" maxlength="50" placeholder="email" />
            <input type="submit" value="Salvar" />
        </form>
      <div class="list">
        <input type="text" placeholder="Pesquisar" />
        <ul>

        </ul> 
      </div>
    </main>

    <script>
        let lista = localStorage.getItem("minhaLista");

        const formulario = document.querySelector("form");
        const ulPessoas = document.querySelector("ul");
       /* if (lista) {
            try {
                lista = JSON.parse(lista);
            } catch (e) {
                console.log("Erro ao fazer persing do JSON:" + e);
                lista = [];
            }
        } else  {
            lista = [];
        } */
    
        if(lista) {
           lista = JSON.parse(lista);
        } else {
            lista = [];
        } 

        console.log(lista);

        formulario.addEventListener("submit", function (e) {
            e.preventDefault();
            //console.log(this);
            let novaPessoa = new Object();
            novaPessoa.nome = this.nome.value; 
            novaPessoa.telefone = this.telefone.value; 
            novaPessoa.email = this.email.value; 
            console.log(novaPessoa);

            lista.push(novaPessoa);

            this.reset();

            localStorage.setItem("minhaLista", JSON.stringify(lista));
           // console.log(jsonlinha);
            listar();
        
        })

        function listar() {
            ulPessoas.innerHTML = "";
            lista.forEach((item,key) => {
                //console.log(item, key);

                linha = document.createElement('li');

                let s = `<button>[Excluir]</button><button>[Editar]</button>`

                linha.innerHTML = "Nome: " + item.nome + "Telefone: " + item.telefone + "email: " + item.email + s;
                ulPessoas.appendChild(linha);
            })
        }
    </script>
    
</body>
</html>