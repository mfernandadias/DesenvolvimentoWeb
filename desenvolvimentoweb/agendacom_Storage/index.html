<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda</title>
    
    <link rel="stylesheet" href="./index.css">

</head>
<body>
    <main> 
        <form> 
            <input type="hidden" name="id"> 
            <input  name="nome" type="text" maxlength="50" placeholder="Nome" required />
            <input name="telefone" type="text" maxlength="50" placeholder="Telefone" required />
            <input name="email" type="text" maxlength="50" placeholder="email" />
            <input type="submit" value="Salvar" />
        </form>
      <div class="list">
        <input id="pesquisa" type="text" placeholder="Pesquisar" onkeyup="listar(this.value)"/>
        <ul>

        </ul> 
      </div>
    </main>

    <script>
        let lista = localStorage.getItem("minhaLista");

        const formulario = document.querySelector("form");
        const ulPessoas = document.querySelector("ul");

        if(lista) {
            lista = JSON.parse(lista);
        } else {
            lista = [];
        }

        listar();

        formulario.addEventListener("submit", function (e){
            e.preventDefault();
            let novaPessoa = new Object();
            novaPessoa.nome = this.nome.value; 
            novaPessoa.telefone = this.telefone.value;
            novaPessoa.email = this.email.value; 
            
            lista.push(novaPessoa);

            this.reset();

            localStorage.setItem("minhaLista", JSON.stringify(lista));

            listar()
        })

        function listar(filtro='') {
            ulPessoas.innerHTML = "";
            lista.forEach((item,key) => {
                console.log(item,key);
               
               if(item.nome.toUpperCase().indexOf(filtro.toUpperCase()) >= 0 || filtro=="") {
                  linha = document.createElement('li');
                  
                  let s = `<button>[Excluir]</button><button>[Editar]</button>`

                  linha.innerHTML = "Nome: " + item.nome + "Telefone: " + item.telefone + "Email: " + item.email + s;
                  ulPessoas.appendChild(linha);
               }
            });
        }
    </script>
    
</body>
</html>